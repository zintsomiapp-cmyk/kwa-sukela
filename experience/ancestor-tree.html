<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Ancestor Tree ¬∑ Izwi Lezindaba ¬∑ Kwa Sukela</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400;1,600&family=Syne:wght@600;700;800&family=DM+Sans:opsz,wght@9..40,400;9..40,500&display=swap" rel="stylesheet">
<style>
:root{
  --night:#0A0603;--ember:#160C04;--coal:#221205;
  --paper:#FAF6EE;--paper2:#F0E8D5;
  --fire:#E8540A;--fire-l:#F97316;--fire-xl:#FBA94C;
  --gold:#C4820A;--gold-xl:#F5C842;
  --teal:#0F9488;--teal-glow:#14E8C8;
  --crimson:#9B1C1C;--earth:#7C3B0F;
  --ink:rgba(250,246,238,.85);--ink-m:rgba(250,246,238,.5);--ink-l:rgba(250,246,238,.28);
}
*{margin:0;padding:0;box-sizing:border-box;}
html{font-size:16px;scroll-behavior:smooth;}
body{
  background:var(--night);
  font-family:'DM Sans',sans-serif;
  color:var(--paper);
  overflow-x:hidden;
  cursor:none;
  min-height:100vh;
}

/* ‚îÄ‚îÄ CURSOR ‚îÄ‚îÄ */
#cur{width:10px;height:10px;border-radius:50%;background:var(--fire-l);position:fixed;top:0;left:0;pointer-events:none;z-index:9999;transform:translate(-50%,-50%);transition:width .12s,height .12s;box-shadow:0 0 10px var(--fire-l);}
#ring{width:34px;height:34px;border-radius:50%;border:2px solid rgba(249,115,22,.6);position:fixed;top:0;left:0;pointer-events:none;z-index:9998;transform:translate(-50%,-50%);transition:width .3s cubic-bezier(.22,1,.36,1),height .3s cubic-bezier(.22,1,.36,1);}
@media(max-width:768px){#cur,#ring{display:none;}}

/* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
nav{position:fixed;top:0;left:0;right:0;z-index:500;background:rgba(10,6,3,.9);backdrop-filter:blur(16px);border-bottom:1px solid rgba(250,246,238,.06);}
.ndebele{height:4px;background:repeating-linear-gradient(90deg,var(--fire) 0,var(--fire) 14.28%,var(--gold-xl) 14.28%,var(--gold-xl) 28.57%,var(--night) 28.57%,var(--night) 42.85%,var(--teal-glow) 42.85%,var(--teal-glow) 57.14%,var(--earth) 57.14%,var(--earth) 71.42%,var(--crimson) 71.42%,var(--crimson) 85.71%,var(--paper2) 85.71%,var(--paper2) 100%);}
.nav-inner{max-width:1280px;margin:0 auto;padding:.8rem 2rem;display:flex;justify-content:space-between;align-items:center;}
.nav-logo{font-family:'Cormorant Garamond',serif;font-size:1.2rem;font-weight:700;color:var(--paper);text-decoration:none;}
.nav-logo em{font-style:italic;color:var(--fire-l);}
.nav-right{display:flex;gap:1rem;align-items:center;}
.nav-link{font-family:'Syne',sans-serif;font-size:.62rem;font-weight:700;letter-spacing:.12em;text-transform:uppercase;color:var(--ink-m);text-decoration:none;transition:color .2s;}
.nav-link:hover{color:var(--fire-xl);}
.nav-cta{font-family:'Syne',sans-serif;font-size:.62rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;padding:.45rem 1.1rem;background:var(--fire);color:var(--paper);text-decoration:none;border-radius:2px;transition:background .2s;}
.nav-cta:hover{background:var(--fire-l);}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.page{display:grid;grid-template-columns:1fr 420px;min-height:100vh;padding-top:52px;}
@media(max-width:900px){.page{grid-template-columns:1fr;}}

/* ‚îÄ‚îÄ LEFT ‚Äî The living tree ‚îÄ‚îÄ */
.tree-side{
  position:relative;overflow:hidden;
  background:radial-gradient(ellipse at 50% 60%,rgba(20,232,200,.04) 0%,transparent 60%),
             radial-gradient(ellipse at 50% 100%,rgba(232,84,10,.08) 0%,transparent 50%),
             var(--night);
}
#treeCanvas{display:block;width:100%;height:100%;min-height:calc(100vh - 52px);}

/* Tree overlay text */
.tree-header{
  position:absolute;top:2rem;left:0;right:0;
  text-align:center;pointer-events:none;
  animation:fadeUp .8s ease .3s both;
}
.th-eyebrow{
  font-family:'Syne',sans-serif;font-size:.62rem;font-weight:700;
  letter-spacing:.2em;text-transform:uppercase;
  color:rgba(20,232,200,.5);margin-bottom:.5rem;
  display:flex;align-items:center;justify-content:center;gap:.8rem;
}
.th-eyebrow::before,.th-eyebrow::after{content:'';width:24px;height:1px;background:rgba(20,232,200,.3);}
.th-title{
  font-family:'Cormorant Garamond',serif;
  font-size:clamp(1.8rem,4vw,3rem);
  font-weight:700;color:var(--paper);line-height:1;
}
.th-title em{font-style:italic;color:var(--teal-glow);}

/* Leaf counter */
.leaf-counter{
  position:absolute;bottom:2rem;left:50%;transform:translateX(-50%);
  text-align:center;pointer-events:none;
}
.lc-big{
  font-family:'Cormorant Garamond',serif;
  font-size:4rem;font-weight:700;color:var(--teal-glow);
  line-height:1;
  text-shadow:0 0 30px rgba(20,232,200,.4);
  transition:transform .3s cubic-bezier(.22,1,.36,1);
}
.lc-big.bump{transform:scale(1.3);}
.lc-label{
  font-family:'Syne',sans-serif;font-size:.6rem;font-weight:700;
  letter-spacing:.15em;text-transform:uppercase;
  color:rgba(20,232,200,.4);margin-top:.3rem;
}
.lc-ubuntu{
  font-family:'Cormorant Garamond',serif;font-size:.92rem;font-style:italic;
  color:rgba(250,246,238,.25);margin-top:.4rem;
}

/* ‚îÄ‚îÄ RIGHT ‚Äî The contribution panel ‚îÄ‚îÄ */
.contrib-side{
  background:var(--ember);
  border-left:1px solid rgba(250,246,238,.06);
  display:flex;flex-direction:column;
  overflow-y:auto;
  max-height:calc(100vh - 52px);
  position:sticky;top:52px;
}
@media(max-width:900px){
  .contrib-side{position:static;max-height:none;border-left:none;border-top:1px solid rgba(250,246,238,.06);}
}

/* Panel sections */
.panel-section{padding:2rem;border-bottom:1px solid rgba(250,246,238,.06);}
.panel-section:last-child{border-bottom:none;}

.ps-label{
  font-family:'Syne',sans-serif;font-size:.58rem;font-weight:700;
  letter-spacing:.18em;text-transform:uppercase;
  color:var(--fire-xl);margin-bottom:.6rem;
  display:flex;align-items:center;gap:.6rem;
}
.ps-label::before{content:'';width:20px;height:2px;background:var(--fire);}
.ps-title{
  font-family:'Cormorant Garamond',serif;font-size:1.6rem;font-weight:700;
  color:var(--paper);line-height:1.05;margin-bottom:.5rem;
}
.ps-body{font-size:.9rem;color:var(--ink-m);line-height:1.7;}
.ps-body strong{color:var(--fire-xl);font-weight:500;}

/* Form */
.form-label{
  font-family:'Syne',sans-serif;font-size:.56rem;font-weight:700;
  letter-spacing:.12em;text-transform:uppercase;
  color:var(--ink-l);margin-bottom:.4rem;display:block;
}
.inp{
  width:100%;padding:.8rem 1rem;margin-bottom:1rem;
  background:rgba(250,246,238,.05);
  border:1px solid rgba(250,246,238,.1);
  border-radius:2px;color:var(--paper);
  font-family:'DM Sans',sans-serif;font-size:.95rem;
  outline:none;transition:border-color .2s,box-shadow .2s;
}
.inp:focus{border-color:rgba(232,84,10,.5);box-shadow:0 0 0 3px rgba(232,84,10,.08);}
.inp::placeholder{color:rgba(250,246,238,.2);}
textarea.inp{resize:none;line-height:1.65;height:90px;font-family:'Cormorant Garamond',serif;font-size:1rem;}

/* Language buttons */
.lang-row{display:flex;gap:.4rem;flex-wrap:wrap;margin-bottom:1rem;}
.lang-btn{
  font-family:'Syne',sans-serif;font-size:.56rem;font-weight:700;
  letter-spacing:.06em;padding:.3rem .75rem;
  border-radius:40px;border:1px solid rgba(250,246,238,.12);
  background:none;color:rgba(250,246,238,.35);cursor:none;
  transition:all .2s;
}
.lang-btn:hover,.lang-btn.sel{
  border-color:rgba(232,84,10,.5);color:var(--fire-xl);background:rgba(232,84,10,.08);
}

/* Submit button */
.btn-plant{
  width:100%;padding:.9rem 1.2rem;
  font-family:'Syne',sans-serif;font-size:.7rem;font-weight:700;
  letter-spacing:.12em;text-transform:uppercase;
  background:var(--fire);color:var(--paper);
  border:none;border-radius:2px;cursor:none;
  transition:background .2s,box-shadow .2s,transform .15s;
  display:flex;align-items:center;justify-content:center;gap:.6rem;
}
.btn-plant:hover{background:var(--fire-l);box-shadow:0 0 24px rgba(232,84,10,.35);transform:translateY(-2px);}
.btn-plant:active{transform:translateY(0);}

/* Char counter */
.char-count{
  font-family:'Syne',sans-serif;font-size:.54rem;font-weight:600;
  letter-spacing:.06em;color:var(--ink-l);text-align:right;
  margin-top:-.7rem;margin-bottom:.8rem;
}
.char-count.warn{color:var(--fire-xl);}

/* Success state */
#success{display:none;padding:2rem;text-align:center;}
#success.show{display:block;animation:fadeUp .5s ease;}
.succ-icon{font-size:3rem;margin-bottom:1rem;}
.succ-title{font-family:'Cormorant Garamond',serif;font-size:1.6rem;font-weight:700;color:var(--paper);margin-bottom:.5rem;}
.succ-body{font-size:.9rem;color:var(--ink-m);line-height:1.65;margin-bottom:1.5rem;}
.succ-ubuntu{
  font-family:'Cormorant Garamond',serif;font-size:1.1rem;font-style:italic;
  color:var(--teal-glow);margin-bottom:1.5rem;
}
.btn-again{
  font-family:'Syne',sans-serif;font-size:.65rem;font-weight:700;
  letter-spacing:.1em;text-transform:uppercase;
  padding:.65rem 1.4rem;
  border:1px solid rgba(20,232,200,.3);color:var(--teal-glow);
  background:rgba(20,232,200,.07);border-radius:2px;cursor:none;
  transition:all .2s;
}
.btn-again:hover{background:rgba(20,232,200,.15);}

/* Leaves list */
.leaves-list{display:flex;flex-direction:column;gap:.6rem;}
.leaf-item{
  padding:.9rem 1rem;
  background:rgba(250,246,238,.03);
  border:1px solid rgba(250,246,238,.06);
  border-radius:2px;
  border-left:2px solid rgba(20,232,200,.3);
  animation:leafIn .4s ease;
  position:relative;overflow:hidden;
}
@keyframes leafIn{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:none;}}
.leaf-item::before{
  content:'üåø';position:absolute;right:.7rem;top:.7rem;
  font-size:.8rem;opacity:.3;
}
.li-text{
  font-family:'Cormorant Garamond',serif;font-size:.98rem;font-style:italic;
  color:rgba(250,246,238,.75);line-height:1.5;margin-bottom:.35rem;
}
.li-meta{
  font-family:'Syne',sans-serif;font-size:.52rem;font-weight:700;
  letter-spacing:.08em;text-transform:uppercase;
  color:rgba(20,232,200,.35);
  display:flex;justify-content:space-between;
}

/* Empty state */
.empty-state{
  text-align:center;padding:2rem 1rem;
  font-family:'Cormorant Garamond',serif;font-size:1rem;font-style:italic;
  color:var(--ink-l);line-height:1.6;
}

@keyframes fadeUp{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:none;}}
</style>
</head>
<body>

<div id="cur"></div>
<div id="ring"></div>

<!-- ‚îÄ‚îÄ NAV ‚îÄ‚îÄ -->
<nav>
  <div class="ndebele"></div>
  <div class="nav-inner">
    <a href="index.html" class="nav-logo">Kwa <em>Sukela</em></a>
    <div class="nav-right">
      <a href="drum.html" class="nav-link">Drum Rhythm</a>
      <a href="vr-world.html" class="nav-link">VR World</a>
      <a href="index.html#enrol" class="nav-cta">Enrol</a>
    </div>
  </div>
</nav>

<div class="page">

  <!-- ‚îÄ‚îÄ LEFT: LIVING TREE CANVAS ‚îÄ‚îÄ -->
  <div class="tree-side">
    <canvas id="treeCanvas"></canvas>

    <div class="tree-header">
      <div class="th-eyebrow">Ubuntu ¬∑ I am because we are</div>
      <h1 class="th-title">The Ancestor <em>Tree</em></h1>
    </div>

    <div class="leaf-counter">
      <div class="lc-big" id="leafCount">0</div>
      <div class="lc-label">Leaves on the Tree</div>
      <div class="lc-ubuntu">"Umuntu ngumuntu ngabantu"</div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ RIGHT: CONTRIBUTION PANEL ‚îÄ‚îÄ -->
  <div class="contrib-side">

    <!-- What is this -->
    <div class="panel-section">
      <div class="ps-label">The Ancestor Tree</div>
      <h2 class="ps-title">Leave Your Mark.<br>Forever.</h2>
      <p class="ps-body">
        Every person who visits this tree leaves something behind ‚Äî a memory, a proverb, a word from home. Your leaf grows on the tree <strong>permanently</strong>. Future visitors will read it. That is ubuntu made digital.
      </p>
    </div>

    <!-- Form -->
    <div class="panel-section" id="formSection">
      <label class="form-label">Your name</label>
      <input class="inp" id="leaf-name" type="text" placeholder="Thandi, Sipho, Lerato, Nomsa‚Ä¶" maxlength="40">

      <label class="form-label">Your language</label>
      <div class="lang-row">
        <button class="lang-btn sel" data-lang="isiZulu">isiZulu</button>
        <button class="lang-btn" data-lang="isiXhosa">isiXhosa</button>
        <button class="lang-btn" data-lang="Sesotho">Sesotho</button>
        <button class="lang-btn" data-lang="Setswana">Setswana</button>
        <button class="lang-btn" data-lang="English">English</button>
        <button class="lang-btn" data-lang="Afrikaans">Afrikaans</button>
        <button class="lang-btn" data-lang="Sepedi">Sepedi</button>
        <button class="lang-btn" data-lang="Xitsonga">Xitsonga</button>
      </div>

      <label class="form-label">One sentence ‚Äî a memory, proverb, or word from home</label>
      <textarea class="inp" id="leaf-text" placeholder="Umuntu ngumuntu ngabantu‚Ä¶" maxlength="140" oninput="updateCount()"></textarea>
      <div class="char-count" id="charCount">0 / 140</div>

      <button class="btn-plant" onclick="plantLeaf()">
        üåø Plant Your Leaf on the Tree
      </button>
    </div>

    <!-- Success -->
    <div id="success">
      <div class="succ-icon">üåø</div>
      <div class="succ-title">Your leaf is on the tree.</div>
      <p class="succ-body">It will grow here permanently. Every visitor who comes after you will read your words. That is what it means to leave something behind.</p>
      <div class="succ-ubuntu">"Indlela ibuzwa kwabaphambili."<br><span style="font-size:.8rem;color:var(--ink-l);font-style:normal;">The road is asked of those who went before.</span></div>
      <button class="btn-again" onclick="plantAgain()">Plant Another Leaf</button>
    </div>

    <!-- Existing leaves -->
    <div class="panel-section">
      <div class="ps-label">Voices on the Tree</div>
      <div class="leaves-list" id="leavesList"></div>
    </div>

  </div>
</div>

<script>
// ‚ïê‚ïê STATE ‚ïê‚ïê
let leaves = JSON.parse(localStorage.getItem('izwi-leaves') || '[]');
let selectedLang = 'isiZulu';
let t = 0;
let leafParticles = [];

// ‚ïê‚ïê CURSOR ‚ïê‚ïê
const cur = document.getElementById('cur');
const ring = document.getElementById('ring');
let mx = 0, my = 0, rx = 0, ry = 0;
document.addEventListener('mousemove', e => {
  mx = e.clientX; my = e.clientY;
  cur.style.left = mx + 'px'; cur.style.top = my + 'px';
});
(function loop() {
  rx += (mx - rx) * .12; ry += (my - ry) * .12;
  ring.style.left = rx + 'px'; ring.style.top = ry + 'px';
  requestAnimationFrame(loop);
})();
document.querySelectorAll('a,button,input,textarea').forEach(el => {
  el.addEventListener('mouseenter', () => { ring.style.width = '50px'; ring.style.height = '50px'; });
  el.addEventListener('mouseleave', () => { ring.style.width = '34px'; ring.style.height = '34px'; });
});

// ‚ïê‚ïê CANVAS TREE ‚ïê‚ïê
const canvas = document.getElementById('treeCanvas');
const ctx = canvas.getContext('2d');

function resize() {
  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;
}
resize();
window.addEventListener('resize', resize, { passive: true });

// Recursive branch with gentle sway
function branch(x, y, angle, len, depth, sway) {
  if (depth <= 0 || len < 2) return;

  const wobble = Math.sin(t * .6 + depth * .8) * sway;
  const ex = x + Math.cos(angle + wobble) * len;
  const ey = y + Math.sin(angle + wobble) * len;

  // Branch stroke
  const alpha = depth > 4 ? .6 : depth > 2 ? .45 : .3;
  const r = depth > 4 ? 230 : 20;
  const g = depth > 4 ? 100 : 232;
  const b = depth > 4 ? 60 : 200;

  ctx.beginPath();
  ctx.moveTo(x, y);
  ctx.lineTo(ex, ey);
  ctx.strokeStyle = depth > 4
    ? `rgba(${r},${g},${b},${alpha})`
    : `rgba(20,232,200,${alpha})`;
  ctx.lineWidth = depth * .9;
  ctx.lineCap = 'round';
  ctx.stroke();

  // Glow on tips
  if (depth <= 2) {
    const pulse = .5 + .5 * Math.sin(t * 1.2 + depth * 2);
    const grd = ctx.createRadialGradient(ex, ey, 0, ex, ey, 10 + pulse * 6);
    grd.addColorStop(0, `rgba(20,232,200,${.4 * pulse})`);
    grd.addColorStop(1, 'rgba(20,232,200,0)');
    ctx.beginPath();
    ctx.arc(ex, ey, 10 + pulse * 6, 0, Math.PI * 2);
    ctx.fillStyle = grd;
    ctx.fill();

    // Draw a leaf orb for each actual user leaf
    if (Math.random() < .04 && leaves.length > 0) {
      spawnLeafParticle(ex, ey);
    }
  }

  const lenR = .62 + Math.sin(t * .2) * .02;
  const spread = .42 + Math.sin(t * .15 + depth) * .04;
  branch(ex, ey, angle - spread, len * lenR, depth - 1, sway * .8);
  branch(ex, ey, angle + spread, len * lenR, depth - 1, sway * .8);
}

// Leaf particles ‚Äî user leaves floating up
function spawnLeafParticle(x, y) {
  if (leafParticles.length > 60) return;
  leafParticles.push({
    x, y,
    vx: (Math.random() - .5) * .5,
    vy: -(Math.random() * .4 + .1),
    life: 1,
    decay: .005 + Math.random() * .008,
    size: 2 + Math.random() * 3,
    hue: Math.random() > .5 ? 'teal' : 'gold'
  });
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Background warmth at ground
  const groundGlow = ctx.createRadialGradient(
    canvas.width / 2, canvas.height,
    0,
    canvas.width / 2, canvas.height,
    canvas.width * .5
  );
  groundGlow.addColorStop(0, 'rgba(232,84,10,.1)');
  groundGlow.addColorStop(.4, 'rgba(196,130,10,.04)');
  groundGlow.addColorStop(1, 'rgba(0,0,0,0)');
  ctx.fillStyle = groundGlow;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Fire at base
  const fireY = canvas.height * .82;
  const firePulse = .7 + .3 * Math.sin(t * 3);
  const fireGlow = ctx.createRadialGradient(
    canvas.width / 2, fireY, 0,
    canvas.width / 2, fireY, 60 * firePulse
  );
  fireGlow.addColorStop(0, 'rgba(232,84,10,.5)');
  fireGlow.addColorStop(.4, 'rgba(196,130,10,.2)');
  fireGlow.addColorStop(1, 'rgba(0,0,0,0)');
  ctx.beginPath();
  ctx.arc(canvas.width / 2, fireY, 60 * firePulse, 0, Math.PI * 2);
  ctx.fillStyle = fireGlow;
  ctx.fill();

  // The tree ‚Äî grows from fire
  const rootX = canvas.width / 2;
  const rootY = canvas.height * .82;
  const baseLen = canvas.height * .25;
  branch(rootX, rootY, -Math.PI / 2, baseLen, 9, .06);

  // Leaf particles from user contributions
  leafParticles = leafParticles.filter(p => {
    p.x += p.vx; p.y += p.vy;
    p.life -= p.decay;
    if (p.life <= 0) return false;
    const c = p.hue === 'teal' ? '20,232,200' : '245,200,66';
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
    const pg = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.size * 2);
    pg.addColorStop(0, `rgba(${c},${p.life * .8})`);
    pg.addColorStop(1, `rgba(${c},0)`);
    ctx.fillStyle = pg;
    ctx.fill();
    return true;
  });

  // Ground line
  ctx.beginPath();
  ctx.moveTo(canvas.width * .1, canvas.height * .82);
  ctx.lineTo(canvas.width * .9, canvas.height * .82);
  ctx.strokeStyle = 'rgba(232,84,10,.12)';
  ctx.lineWidth = 1;
  ctx.stroke();

  // Floating story orbs representing user leaves
  const leafCount = Math.min(leaves.length, 20);
  for (let i = 0; i < leafCount; i++) {
    const angle = (i / leafCount) * Math.PI * 2 + t * .08;
    const r = canvas.width * (.15 + (i % 3) * .07);
    const ox = rootX + Math.cos(angle) * r * .6;
    const oy = rootY - canvas.height * .3 - Math.sin(angle * .5) * r * .3;
    const pulse = .5 + .5 * Math.sin(t * .8 + i * 1.2);
    ctx.beginPath();
    ctx.arc(ox, oy, 3 + pulse * 2, 0, Math.PI * 2);
    const og = ctx.createRadialGradient(ox, oy, 0, ox, oy, 8 + pulse * 6);
    og.addColorStop(0, `rgba(20,232,200,${.5 + pulse * .3})`);
    og.addColorStop(1, 'rgba(20,232,200,0)');
    ctx.fillStyle = og;
    ctx.fill();
  }

  t += .012;
  requestAnimationFrame(draw);
}
draw();

// ‚ïê‚ïê LANGUAGE SELECTOR ‚ïê‚ïê
document.querySelectorAll('.lang-btn').forEach(btn => {
  btn.addEventListener('click', function () {
    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('sel'));
    this.classList.add('sel');
    selectedLang = this.getAttribute('data-lang');
  });
});

// ‚ïê‚ïê CHAR COUNT ‚ïê‚ïê
function updateCount() {
  const ta = document.getElementById('leaf-text');
  const cc = document.getElementById('charCount');
  const len = ta.value.length;
  cc.textContent = `${len} / 140`;
  cc.classList.toggle('warn', len > 110);
}

// ‚ïê‚ïê PLANT LEAF ‚ïê‚ïê
function plantLeaf() {
  const name = document.getElementById('leaf-name').value.trim();
  const text = document.getElementById('leaf-text').value.trim();
  if (!name) { document.getElementById('leaf-name').focus(); return; }
  if (!text) { document.getElementById('leaf-text').focus(); return; }

  const leaf = {
    name,
    text,
    lang: selectedLang,
    time: Date.now(),
    id: Math.random().toString(36).slice(2)
  };
  leaves.unshift(leaf);
  localStorage.setItem('izwi-leaves', JSON.stringify(leaves));

  // Update counter with bump
  const countEl = document.getElementById('leafCount');
  countEl.textContent = leaves.length;
  countEl.classList.add('bump');
  setTimeout(() => countEl.classList.remove('bump'), 400);

  // Spawn celebration particles
  for (let i = 0; i < 12; i++) spawnLeafParticle(
    canvas.width / 2 + (Math.random() - .5) * 80,
    canvas.height * .55
  );

  // Show success
  document.getElementById('formSection').style.display = 'none';
  document.getElementById('success').classList.add('show');
  renderLeaves();
}

function plantAgain() {
  document.getElementById('success').classList.remove('show');
  document.getElementById('formSection').style.display = 'block';
  document.getElementById('leaf-name').value = '';
  document.getElementById('leaf-text').value = '';
  updateCount();
}

// ‚ïê‚ïê RENDER LEAVES LIST ‚ïê‚ïê
function renderLeaves() {
  const list = document.getElementById('leavesList');
  if (leaves.length === 0) {
    list.innerHTML = '<div class="empty-state">The tree is waiting for its first leaf.<br>Be the first to leave your mark.</div>';
    return;
  }
  list.innerHTML = '';
  leaves.slice(0, 20).forEach(l => {
    const d = document.createElement('div');
    d.className = 'leaf-item';
    const ago = timeAgo(l.time);
    d.innerHTML = `
      <div class="li-text">"${escHtml(l.text)}"</div>
      <div class="li-meta">
        <span>${escHtml(l.name)} ¬∑ ${escHtml(l.lang)}</span>
        <span>${ago}</span>
      </div>`;
    list.appendChild(d);
  });
}

function timeAgo(ts) {
  const diff = Date.now() - ts;
  const m = Math.floor(diff / 60000);
  if (m < 1) return 'just now';
  if (m < 60) return `${m}m ago`;
  const h = Math.floor(m / 60);
  if (h < 24) return `${h}h ago`;
  return `${Math.floor(h / 24)}d ago`;
}

function escHtml(s) {
  return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}

// Init
document.getElementById('leafCount').textContent = leaves.length;
renderLeaves();
</script>
</body>
</html>
